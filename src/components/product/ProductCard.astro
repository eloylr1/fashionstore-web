---
/**
 * ═══════════════════════════════════════════════════════════════════════════
 * FASHIONMARKET - ProductCard Component
 * Tarjeta de producto para listados - Diseño Premium
 * ═══════════════════════════════════════════════════════════════════════════
 */

import type { Product } from '../../lib/supabase/database.types';
import { formatPrice } from '../../stores/cart';

interface Props {
  product: Product;
}

const { product } = Astro.props;
const productUrl = `/producto/${product.slug}`;
const mainImage = product.images[0] || 'https://images.unsplash.com/photo-1617137968427-85924c800a22?w=600&q=80';
const formattedPrice = formatPrice(product.price);
---

<article class="group cursor-pointer">
  <a href={productUrl} class="block">
    <!-- Image Container -->
    <div class="relative aspect-[3/4] overflow-hidden bg-cream mb-4">
      <img
        src={mainImage}
        alt={product.name}
        loading="lazy"
        class="w-full h-full object-cover transition-all duration-700 ease-out group-hover:scale-110"
      />
      
      <!-- Overlay on hover -->
      <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300"></div>
      
      <!-- Quick View Button (on hover) -->
      <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
        <span class="bg-white px-6 py-3 text-sm font-medium text-navy-900 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 shadow-lg">
          Ver detalles
        </span>
      </div>
      
      <!-- Badges -->
      <div class="absolute top-4 left-4 flex flex-col gap-2">
        {product.stock < 1 && (
          <span class="bg-charcoal-900 text-white px-3 py-1.5 text-xs font-medium uppercase tracking-wider">
            Agotado
          </span>
        )}
        
        {product.featured && product.stock > 0 && (
          <span class="bg-gold-matte text-navy-900 px-3 py-1.5 text-xs font-medium uppercase tracking-wider">
            Destacado
          </span>
        )}
      </div>
      
      <!-- Wishlist Button -->
      <button 
        class="absolute top-4 right-4 w-10 h-10 bg-white/90 backdrop-blur-sm flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-white hover:scale-110"
        aria-label="Añadir a favoritos"
      >
        <svg class="w-5 h-5 text-navy-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg>
      </button>
    </div>
    
    <!-- Product Info -->
    <div class="space-y-2">
      <!-- Category/Color Tag -->
      <p class="text-xs uppercase tracking-[0.15em] text-gold-matte font-medium">
        {product.colors?.length > 0 ? product.colors.join(' · ') : 'Nueva colección'}
      </p>
      
      <!-- Name -->
      <h3 class="font-serif text-lg font-medium text-navy-900 group-hover:text-gold-dark transition-colors leading-tight">
        {product.name}
      </h3>
      
      <!-- Price -->
      <p class="text-base font-semibold text-charcoal-800">
        {formattedPrice}
      </p>
      
      <!-- Sizes Preview -->
      {product.sizes.length > 0 && (
        <div class="pt-2 flex flex-wrap gap-1.5">
          {product.sizes.slice(0, 4).map((size) => (
            <span class="px-2 py-1 text-xs text-charcoal-600 border border-charcoal-200 hover:border-navy-900 transition-colors">
              {size}
            </span>
          ))}
          {product.sizes.length > 4 && (
            <span class="px-2 py-1 text-xs text-charcoal-400">
              +{product.sizes.length - 4}
            </span>
          )}
        </div>
      )}
    </div>
  </a>
</article>
